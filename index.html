<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Simuch Translator · ES ⇄ SIM</title>
<meta name="description" content="Traductor bidireccional Español ⇄ Simuch con autodetección y respaldo.">
<style>
/* estilos base mínimos omitidos por brevedad */

/* Auto-detect indicator LED */
.auto-led {
  display:inline-block;
  width:12px; height:12px;
  margin-left:8px;
  border-radius:999px;
  background: rgba(255,255,255,0.15);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.18);
  vertical-align: middle;
  transition: box-shadow .25s ease, background .25s ease, transform .25s ease, opacity .25s ease;
  opacity:.6;
}
.auto-led.on-orange {
  background: linear-gradient(135deg, #ffa63a, #ff7a00);
  box-shadow: 0 0 10px 2px rgba(255,122,0,.55), 0 0 2px 1px rgba(255,255,255,.25) inset;
  opacity:1;
}
.auto-led.on-purple {
  background: linear-gradient(135deg, #7a2cff, #a33cff);
  box-shadow: 0 0 10px 2px rgba(162,52,255,.55), 0 0 2px 1px rgba(255,255,255,.25) inset;
  opacity:1;
}
.auto-led.pulse { transform: scale(1.08); }
</style>
</head>
<body>
<!-- estructura HTML simplificada -->


<script>
// Indicador LED helper
(function(){
  function ensureAutoLED(){
    const pill = document.querySelector("#dir-pill, [data-dir]") ||
      Array.from(document.querySelectorAll("button, .badge, .pill"))
      .find(el => /ES\s*[→>-]\s*SIM|SIM\s*[→>-]\s*ES/i.test(el.textContent||""));
    if(!pill) return null;
    if(pill._autoLED) return pill._autoLED;
    const led = document.createElement("span");
    led.className = "auto-led";
    led.title = "Autodetección";
    pill.insertAdjacentElement("afterend", led);
    pill._autoLED = led;
    return led;
  }
  window.__autoLED = { set: (mode)=>{
      const led = ensureAutoLED(); if(!led) return;
      led.classList.remove("on-orange","on-purple","pulse");
      if(mode==="off"){ return; }
      if(mode==="orange"){ led.classList.add("on-orange","pulse"); led.title = "Autodetección: ES → SIM"; }
      if(mode==="purple"){ led.classList.add("on-purple","pulse"); led.title = "Autodetección: SIM → ES"; }
      setTimeout(()=> led && led.classList.remove("pulse"), 300);
    }};
})();
</script>

<script>
// Traducción solo al apretar botón
const doTranslate = () => {
  if(!$in || !$out) return;
  const raw = $in.value || "";
  const srcNorm = (raw||"").normalize("NFC").trim().toLowerCase();
  if(!srcNorm){ $out.value = ""; return; }
  const pillText = ($dir && $dir.textContent) || "";
  const chosenDir = pillText.includes("ES → SIM") || pillText.includes("ES->SIM") ? "ES2SIM" : "SIM2ES";
  if(window.__autoLED){ window.__autoLED.set("off"); }
  const map = chosenDir === "ES2SIM" ? ES2SIM : SIM2ES;
  $out.value = translateText(raw, map);
};
</script>

<script>
// Autodetección en vivo (solo ajusta pill + LED)
(function(){
  function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn.apply(null,a),ms);}; }
  function nrm(s){ return (s||"").normalize("NFC").trim().toLowerCase()
    .replace(/[0]/g,"o").replace(/[1|]/g,"l").replace(/[3]/g,"e")
    .replace(/[4]/g,"a").replace(/[5]/g,"s").replace(/[7]/g,"t"); }
  function tokenScore(text){
    const src = nrm(text);
    const words = src.split(/[\s,.;:!?()\"«»“”‘’\-—–]+/g).filter(Boolean);
    let esHits=0, simHits=0;
    for(const w of words){ if(window.ES2SIM && ES2SIM[w]) esHits++; if(window.SIM2ES && SIM2ES[w]) simHits++; }
    return {words, esHits, simHits};
  }
  function guessDir(text){
    const {words, esHits, simHits} = tokenScore(text);
    if(words.length===1){
      const w = nrm(words[0]);
      if(window.SIM2ES && SIM2ES[w] && !(window.ES2SIM && ES2SIM[w])) return "SIM2ES";
      if(window.ES2SIM && ES2SIM[w] && !(window.SIM2ES && SIM2ES[w])) return "ES2SIM";
      if(window.SIM2ES && SIM2ES[w] && window.ES2SIM && ES2SIM[w]) return "SIM2ES";
      return null;
    }
    const total=Math.max(1, words.length);
    const esR=esHits/total, simR=simHits/total;
    const MIN=2, TH=.25;
    if((simHits>=MIN && simR>=TH && simHits>esHits) || (simHits>=1 && esHits===0)) return "SIM2ES";
    if((esHits>=MIN && esR>=TH && esHits>simHits) || (esHits>=1 && simHits===0)) return "ES2SIM";
    return null;
  }
  function applyGuess(dir){
    const pill = document.querySelector("#dir-pill, [data-dir]") ||
      Array.from(document.querySelectorAll("button, .badge, .pill"))
      .find(el => /ES\s*[→>-]\s*SIM|SIM\s*[→>-]\s*ES/i.test(el.textContent||""));
    if(!pill) return;
    if(!dir){ if(window.__autoLED) window.__autoLED.set("off"); return; }
    if(dir==="ES2SIM"){ pill.textContent = "ES → SIM"; if(window.__autoLED) window.__autoLED.set("orange"); }
    else { pill.textContent = "SIM → ES"; if(window.__autoLED) window.__autoLED.set("purple"); }
  }
  function hook(){
    const input = document.querySelector("textarea, #input, [name='input']") || document.querySelectorAll("textarea")[0];
    if(!input) return;
    const run = debounce(()=>{ const d = guessDir(input.value); applyGuess(d); }, 120);
    input.addEventListener("input", run);
    input.addEventListener("change", run);
    run();
  }
  setTimeout(hook, 150);
})();
</script>

</body>
</html>
