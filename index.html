<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Simuch Translator · ES ⇄ SIM</title>
  <meta name="description" content="Traductor bidireccional Español ⇄ Simuch con autodetección y respaldo.">

  <!-- Tus estilos principales -->
  <style>
    body {
      margin:0;
      font-family:sans-serif;
      background:linear-gradient(135deg,#7a2cff,#a33cff);
      color:#fff;
      min-height:100vh;
    }
    header {
      padding:1rem;
      background:linear-gradient(135deg,#ffa63a,#ff7a00);
      color:#111;
      font-weight:700;
      text-align:center;
    }
    textarea {
      width:90%;
      margin:1rem auto;
      display:block;
      min-height:120px;
      font-size:1rem;
      padding:.5rem;
    }
    button {
      display:inline-block;
      padding:.6rem 1.2rem;
      margin:.5rem;
      border:none;
      border-radius:999px;
      cursor:pointer;
      font-weight:600;
      background:linear-gradient(135deg,#ffa63a,#ff7a00);
      color:#111;
    }
    button:hover {opacity:.9}

    /* LED indicador */
    .auto-led{display:inline-block;width:12px;height:12px;margin-left:8px;border-radius:999px;background:rgba(255,255,255,.15);box-shadow:inset 0 0 0 1px rgba(255,255,255,.18);vertical-align:middle;transition:.25s;opacity:.6}
    .auto-led.on-orange{background:linear-gradient(135deg,#ffa63a,#ff7a00);box-shadow:0 0 10px 2px rgba(255,122,0,.55),0 0 2px 1px rgba(255,255,255,.25) inset;opacity:1}
    .auto-led.on-purple{background:linear-gradient(135deg,#7a2cff,#a33cff);box-shadow:0 0 10px 2px rgba(162,52,255,.55),0 0 2px 1px rgba(255,255,255,.25) inset;opacity:1}
    .auto-led.pulse{transform:scale(1.08)}
    footer {
      padding:1rem;
      text-align:center;
      font-size:.85rem;
      background:#111;
    }
  </style>
</head>
<body>
  <header>
    Simuch Translator · ES ⇄ SIM
  </header>

  <main>
    <textarea id="input" placeholder="Escribe aquí..."></textarea>
    <div style="text-align:center;">
      <button id="dir-pill">ES → SIM</button>
      <button id="translate">Traducir</button>
    </div>
    <textarea id="output" readonly placeholder="Traducción..."></textarea>
  </main>

  <footer>
    <div id="visit-counter">Visitas: <span id="visits">200</span></div>
    <div>Creado por Musi Dklja · Simuch Project</div>
  </footer>

  <!-- Simulación simple del diccionario -->
  <script>
    const ES2SIM = {"hola":"su laa","adios":"dag dag","plumba":"fruuvy"};
    const SIM2ES = {"su laa":"hola","dag dag":"adios","plumba":"pene"};

    function translateText(raw,map){
      return raw.split(/\s+/).map(w => map[w.toLowerCase()]||w).join(" ");
    }

    const $in = document.getElementById("input");
    const $out = document.getElementById("output");
    const $btn = document.getElementById("translate");
    const $dir = document.getElementById("dir-pill");

    let uiDir = "ES2SIM"; // dirección inicial

    $btn.addEventListener("click", ()=>{
      const raw = $in.value.trim();
      if(!raw){$out.value="";return;}
      uiDir = $dir.textContent.includes("ES") ? "ES2SIM" : "SIM2ES";
      const map = uiDir==="ES2SIM"?ES2SIM:SIM2ES;
      $out.value = translateText(raw,map);
    });

    $dir.addEventListener("click", ()=>{
      if($dir.textContent.includes("ES")){
        $dir.textContent = "SIM → ES";
      } else {
        $dir.textContent = "ES → SIM";
      }
    });
  </script>

  <!-- AUTO-DETECCIÓN ROBUSTA (pill + LED en tiempo real) -->
  <script>
  (function(){
    function findPill(){
      const cands = [
        document.querySelector("#dir-pill,[data-dir]"),
        ...Array.from(document.querySelectorAll("button,.badge,.pill"))
          .filter(el => /ES\s*[→>-]\s*SIM|SIM\s*[→>-]\s*ES/i.test((el.textContent||"").trim()))
      ].filter(Boolean);
      return cands[0] || null;
    }
    function ensureLED(){
      const pill = findPill(); if(!pill) return null;
      if(pill._autoLED) return pill._autoLED;
      const led = document.createElement("span");
      led.className = "auto-led"; led.title = "Autodetección";
      pill.insertAdjacentElement("afterend", led);
      pill._autoLED = led;
      return led;
    }
    function setLED(mode){
      const led = ensureLED(); if(!led) return;
      led.classList.remove("on-orange","on-purple","pulse");
      if(mode==="off") return;
      if(mode==="orange"){ led.classList.add("on-orange","pulse"); led.title="Autodetección: ES → SIM"; }
      if(mode==="purple"){ led.classList.add("on-purple","pulse"); led.title="Autodetección: SIM → ES"; }
      setTimeout(()=> led && led.classList.remove("pulse"), 300);
    }
    const nrm = s => (s||"").normalize("NFC").trim().toLowerCase()
      .replace(/[0]/g,"o").replace(/[1|]/g,"l").replace(/[3]/g,"e")
      .replace(/[4]/g,"a").replace(/[5]/g,"s").replace(/[7]/g,"t");
    function score(text){
      const src = nrm(text);
      const words = src.split(/[\s,.;:!?()"«»“”‘’\-—–]+/g).filter(Boolean);
      let es=0, sim=0;
      for(const w of words){
        if(window.ES2SIM && ES2SIM[w]) es++;
        if(window.SIM2ES && SIM2ES[w]) sim++;
      }
      return {words, es, sim};
    }
    function guessDir(text){
      const {words, es, sim} = score(text);
      if(words.length===1){
        const w = words[0];
        if(window.SIM2ES && SIM2ES[w] && !(window.ES2SIM && ES2SIM[w])) return "SIM2ES";
        if(window.ES2SIM && ES2SIM[w] && !(window.SIM2ES && SIM2ES[w])) return "ES2SIM";
        if(window.SIM2ES && SIM2ES[w] && window.ES2SIM && ES2SIM[w]) return "SIM2ES";
        return null;
      }
      const tot = Math.max(1, words.length), er = es/tot, sr = sim/tot, MIN=2, TH=.25;
      if((sim>=MIN && sr>=TH && sim>es) || (sim>=1 && es===0)) return "SIM2ES";
      if((es>=MIN && er>=TH && es>sim) || (es>=1 && sim===0)) return "ES2SIM";
      return null;
    }
    function apply(dir){
      const pill = findPill();
      if(!pill){ setLED("off"); return; }
      if(!dir){ setLED("off"); return; }
      if(dir === "ES2SIM"){ pill.textContent = "ES → SIM"; setLED("orange"); }
      else { pill.textContent = "SIM → ES"; setLED("purple"); }
    }
    function candidateInputs(){
      const sels = [
        "textarea#in","textarea[name='in']","#in","[name='in']",
        "textarea#input","textarea[name='input']","#input","[name='input']",
        "textarea",".editor textarea",".panel textarea"
      ];
      const arr = [];
      sels.forEach(sel => document.querySelectorAll(sel).forEach(el => arr.push(el)));
      return Array.from(new Set(arr))
        .filter(el => el.offsetWidth>0 && el.offsetHeight>0)
        .sort((a,b)=> (b.value?.length||0) - (a.value?.length||0));
    }
    let hookedEl = null;
    let handler = null;
    function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn.apply(null,a),ms);} }
    function hookInput(el){
      if(!el || el === hookedEl) return;
      if(hookedEl && handler){
        hookedEl.removeEventListener("input", handler);
        hookedEl.removeEventListener("change", handler);
      }
      hookedEl = el;
      handler = debounce(()=>{ const d = guessDir(hookedEl.value||""); apply(d); }, 120);
      hookedEl.addEventListener("input", handler);
      hookedEl.addEventListener("change", handler);
      handler();
    }
    const observer = new MutationObserver(()=>{
      const cand = candidateInputs()[0] || null;
      hookInput(cand);
    });
    observer.observe(document.documentElement, {childList:true, subtree:true});
    hookInput(candidateInputs()[0] || null);
  })();
  </script>
</body>
</html>
